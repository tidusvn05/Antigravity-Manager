#!/usr/bin/env bash

# Antigravity Manager CLI Wrapper
# Cho ph√©p g·ªçi l·ªánh t·ª´ b·∫•t k·ª≥ ƒë√¢u trong terminal

# L·∫•y ƒë∆∞·ªùng d·∫´n th·ª±c c·ªßa script n√†y (resolve symlink)
SCRIPT_PATH="${BASH_SOURCE[0]}"
# N·∫øu l√† symlink, l·∫•y ƒë∆∞·ªùng d·∫´n th·ª±c
while [ -L "$SCRIPT_PATH" ]; do
    SCRIPT_DIR="$( cd -P "$( dirname "$SCRIPT_PATH" )" && pwd )"
    SCRIPT_PATH="$(readlink "$SCRIPT_PATH")"
    # N·∫øu readlink tr·∫£ v·ªÅ relative path, c·∫ßn combine v·ªõi SCRIPT_DIR
    [[ $SCRIPT_PATH != /* ]] && SCRIPT_PATH="$SCRIPT_DIR/$SCRIPT_PATH"
done
SCRIPT_DIR="$( cd -P "$( dirname "$SCRIPT_PATH" )" && pwd )"
# ƒê∆∞·ªùng d·∫´n ƒë·∫øn th∆∞ m·ª•c g·ªëc c·ªßa project (parent c·ªßa bin/)
PROJECT_ROOT="$(dirname "$SCRIPT_DIR")"

# ƒê∆∞·ªùng d·∫´n ƒë·∫øn Python virtual environment
VENV_PYTHON="$PROJECT_ROOT/.venv/bin/python"

# ƒê∆∞·ªùng d·∫´n ƒë·∫øn main.py
MAIN_PY="$PROJECT_ROOT/main.py"

# Ki·ªÉm tra xem virtual environment c√≥ t·ªìn t·∫°i kh√¥ng
if [ ! -f "$VENV_PYTHON" ]; then
    echo "‚ùå L·ªói: Kh√¥ng t√¨m th·∫•y Python virtual environment t·∫°i $VENV_PYTHON"
    echo "üí° Vui l√≤ng ch·∫°y: python3 -m venv .venv && source .venv/bin/activate && pip install -r requirements.txt"
    exit 1
fi

# Ki·ªÉm tra xem main.py c√≥ t·ªìn t·∫°i kh√¥ng
if [ ! -f "$MAIN_PY" ]; then
    echo "‚ùå L·ªói: Kh√¥ng t√¨m th·∫•y main.py t·∫°i $MAIN_PY"
    exit 1
fi

# Ch·∫°y main.py v·ªõi t·∫•t c·∫£ c√°c tham s·ªë ƒë∆∞·ª£c truy·ªÅn v√†o
"$VENV_PYTHON" "$MAIN_PY" "$@"
