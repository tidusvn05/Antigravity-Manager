#!/usr/bin/env bash

# Antigravity Manager GUI Wrapper
# Cho phÃ©p cháº¡y GUI tá»« báº¥t ká»³ Ä‘Ã¢u trong terminal

# Láº¥y Ä‘Æ°á»ng dáº«n thá»±c cá»§a script nÃ y (resolve symlink)
SCRIPT_PATH="${BASH_SOURCE[0]}"
# Náº¿u lÃ  symlink, láº¥y Ä‘Æ°á»ng dáº«n thá»±c
while [ -L "$SCRIPT_PATH" ]; do
    SCRIPT_DIR="$( cd -P "$( dirname "$SCRIPT_PATH" )" && pwd )"
    SCRIPT_PATH="$(readlink "$SCRIPT_PATH")"
    # Náº¿u readlink tráº£ vá» relative path, cáº§n combine vá»›i SCRIPT_DIR
    [[ $SCRIPT_PATH != /* ]] && SCRIPT_PATH="$SCRIPT_DIR/$SCRIPT_PATH"
done
SCRIPT_DIR="$( cd -P "$( dirname "$SCRIPT_PATH" )" && pwd )"
# ÄÆ°á»ng dáº«n Ä‘áº¿n thÆ° má»¥c gá»‘c cá»§a project (parent cá»§a bin/)
PROJECT_ROOT="$(dirname "$SCRIPT_DIR")"

# ÄÆ°á»ng dáº«n Ä‘áº¿n Python virtual environment
VENV_PYTHON="$PROJECT_ROOT/.venv/bin/python"

# ÄÆ°á»ng dáº«n Ä‘áº¿n gui/main.py
GUI_MAIN_PY="$PROJECT_ROOT/gui/main.py"

# Kiá»ƒm tra xem virtual environment cÃ³ tá»“n táº¡i khÃ´ng
if [ ! -f "$VENV_PYTHON" ]; then
    echo "âŒ Lá»—i: KhÃ´ng tÃ¬m tháº¥y Python virtual environment táº¡i $VENV_PYTHON"
    echo "ğŸ’¡ Vui lÃ²ng cháº¡y: python3 -m venv .venv && source .venv/bin/activate && pip install -r requirements.txt"
    exit 1
fi

# Kiá»ƒm tra xem gui/main.py cÃ³ tá»“n táº¡i khÃ´ng
if [ ! -f "$GUI_MAIN_PY" ]; then
    echo "âŒ Lá»—i: KhÃ´ng tÃ¬m tháº¥y gui/main.py táº¡i $GUI_MAIN_PY"
    exit 1
fi

# Cháº¡y GUI
echo "ğŸš€ Äang khá»Ÿi Ä‘á»™ng Antigravity Manager GUI..."
"$VENV_PYTHON" "$GUI_MAIN_PY"
